import{r as e,j as a}from"./vendor-react-Di3sF8BB.js";import{b as s,u as r,c as i}from"./vendor-query-B031p5Or.js";import{B as n,I as l,C as t,n as c,i as m,s as d}from"./index-DztaS-sJ.js";import{D as o,a as u,b as h,c as j,d as x}from"./dialog-DU5NScf_.js";import{L as g}from"./label-CY7WyAhe.js";import{T as _,a as p,b as v,c as f,d as y,e as N}from"./table-Cyg5OxQE.js";import{u as w}from"./useImageUpload-ciK5o9-x.js";import{z as b,L as z,a0 as C,a2 as q,D as k}from"./vendor-icons-UB6tg7n9.js";import"./vendor-radix-AkGGdVjm.js";import"./vendor-utils-BNexaxpF.js";import"./vendor-supabase-CKi7xGwz.js";const S={name_uz:"",name_ru:"",name_en:"",image_url:""},K=()=>{const[K,R]=e.useState(!1),[U,E]=e.useState(S),F=s(),L=e.useRef(null),{uploadImage:I,uploading:P}=w("category-images"),{data:Q,isLoading:B}=r({queryKey:["admin-categories"],queryFn:async()=>{const{data:e,error:a}=await d.from("categories").select("*").order("name_uz");if(a)throw a;return e}}),D=i({mutationFn:async e=>{if(e.id){const{error:a}=await d.from("categories").update({name_uz:e.name_uz,name_ru:e.name_ru,name_en:e.name_en,image_url:e.image_url}).eq("id",e.id);if(a)throw a}else{const{error:a}=await d.from("categories").insert({name_uz:e.name_uz,name_ru:e.name_ru,name_en:e.name_en,image_url:e.image_url});if(a)throw a}},onSuccess:()=>{F.invalidateQueries({queryKey:["admin-categories"]}),R(!1),E(S),m.success("Kategoriya saqlandi")},onError:()=>{m.error("Xatolik yuz berdi")}}),O=i({mutationFn:async e=>{const{error:a}=await d.from("categories").delete().eq("id",e);if(a)throw a},onSuccess:()=>{F.invalidateQueries({queryKey:["admin-categories"]}),m.success("O'chirildi")}});return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Kategoriyalar"}),a.jsxs(o,{open:K,onOpenChange:R,children:[a.jsx(u,{asChild:!0,children:a.jsxs(n,{onClick:()=>E(S),children:[a.jsx(b,{className:"h-4 w-4 mr-2"}),"Qo'shish"]})}),a.jsxs(h,{children:[a.jsx(j,{children:a.jsx(x,{children:U.id?"Tahrirlash":"Yangi kategoriya"})}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{children:[a.jsx(g,{children:"Nomi (UZ)"}),a.jsx(l,{value:U.name_uz,onChange:e=>E({...U,name_uz:e.target.value})})]}),a.jsxs("div",{children:[a.jsx(g,{children:"Nomi (RU)"}),a.jsx(l,{value:U.name_ru,onChange:e=>E({...U,name_ru:e.target.value})})]}),a.jsxs("div",{children:[a.jsx(g,{children:"Nomi (EN)"}),a.jsx(l,{value:U.name_en,onChange:e=>E({...U,name_en:e.target.value})})]}),a.jsxs("div",{children:[a.jsx(g,{children:"Rasm"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(l,{value:U.image_url,onChange:e=>E({...U,image_url:e.target.value}),placeholder:"URL yoki fayl yuklang"}),a.jsx("input",{ref:L,type:"file",accept:"image/*",onChange:async e=>{const a=e.target.files?.[0];if(!a)return;const s=await I(a);s&&E({...U,image_url:s}),L.current&&(L.current.value="")},className:"hidden"}),a.jsx(n,{type:"button",variant:"outline",onClick:()=>L.current?.click(),disabled:P,children:P?a.jsx(z,{className:"h-4 w-4 animate-spin"}):a.jsx(C,{className:"h-4 w-4"})})]})]}),U.image_url&&a.jsx("div",{className:"flex justify-center",children:a.jsx("img",{src:U.image_url,alt:"Preview",className:"w-32 h-32 object-cover rounded"})}),a.jsx(n,{onClick:()=>D.mutate(U),disabled:D.isPending,children:D.isPending?"Saqlanmoqda...":"Saqlash"})]})]})]})]}),a.jsx(t,{children:a.jsx(c,{className:"p-0",children:a.jsxs(_,{children:[a.jsx(p,{children:a.jsxs(v,{children:[a.jsx(f,{children:"Rasm"}),a.jsx(f,{children:"Nomi (UZ)"}),a.jsx(f,{children:"Nomi (RU)"}),a.jsx(f,{children:"Nomi (EN)"}),a.jsx(f,{className:"text-right",children:"Amallar"})]})}),a.jsxs(y,{children:[Q?.map(e=>a.jsxs(v,{children:[a.jsx(N,{children:e.image_url?a.jsx("img",{src:e.image_url,alt:"",className:"w-12 h-12 object-cover rounded"}):a.jsx("div",{className:"w-12 h-12 bg-muted rounded"})}),a.jsx(N,{className:"font-medium",children:e.name_uz}),a.jsx(N,{children:e.name_ru}),a.jsx(N,{children:e.name_en}),a.jsxs(N,{className:"text-right",children:[a.jsx(n,{variant:"ghost",size:"icon",onClick:()=>(e=>{E({id:e.id,name_uz:e.name_uz,name_ru:e.name_ru,name_en:e.name_en,image_url:e.image_url||""}),R(!0)})(e),children:a.jsx(q,{className:"h-4 w-4"})}),a.jsx(n,{variant:"ghost",size:"icon",onClick:()=>O.mutate(e.id),children:a.jsx(k,{className:"h-4 w-4 text-destructive"})})]})]},e.id)),B&&a.jsx(v,{children:a.jsx(N,{colSpan:5,className:"text-center py-8",children:"Yuklanmoqda..."})}),!B&&0===Q?.length&&a.jsx(v,{children:a.jsx(N,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Kategoriyalar topilmadi"})})]})]})})})]})};export{K as default};
