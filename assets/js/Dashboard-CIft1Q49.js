import{j as e}from"./vendor-react-Di3sF8BB.js";import{u as s}from"./vendor-query-B031p5Or.js";import{C as t,o as a,p as r,n as l,s as d}from"./index-DztaS-sJ.js";import{h as n,T as c,N as o,E as i,n as x,$ as m}from"./vendor-icons-UB6tg7n9.js";import{R as u,B as h,C as j,X as f,Y as g,T as y,a as p,P as N,b as v,d as b}from"./vendor-utils-BNexaxpF.js";import"./vendor-radix-AkGGdVjm.js";import"./vendor-supabase-CKi7xGwz.js";const w=["hsl(var(--primary))","hsl(var(--secondary))","hsl(var(--accent))","#10b981","#f59e0b"],_=()=>{const{data:_}=s({queryKey:["admin-stats"],queryFn:async()=>{const[e,s,t,a]=await Promise.all([d.from("orders").select("*",{count:"exact",head:!0}),d.from("products").select("*",{count:"exact",head:!0}),d.from("profiles").select("*",{count:"exact",head:!0}),d.from("orders").select("*",{count:"exact",head:!0}).gte("created_at",(new Date).toISOString().split("T")[0])]);return{totalOrders:e.count||0,totalProducts:s.count||0,totalUsers:t.count||0,todayOrders:a.count||0}}}),{data:q}=s({queryKey:["top-products"],queryFn:async()=>{const{data:e}=await d.from("products").select("id, name_uz, sold_count, view_count").order("sold_count",{ascending:!1}).limit(5);return e||[]}}),{data:k}=s({queryKey:["category-stats"],queryFn:async()=>{const{data:e}=await d.from("categories").select("id, name_uz"),{data:s}=await d.from("products").select("category_id, sold_count"),t=new Map;return e?.forEach(e=>{t.set(e.id,{name:e.name_uz,value:0})}),s?.forEach(e=>{if(e.category_id&&t.has(e.category_id)){t.get(e.category_id).value+=e.sold_count||0}}),Array.from(t.values()).filter(e=>e.value>0)}}),{data:D}=s({queryKey:["weekly-orders"],queryFn:async()=>{const e=["Yak","Dush","Sesh","Chor","Pay","Jum","Shan"],s=new Date,t=[];for(let a=6;a>=0;a--){const r=new Date(s);r.setDate(r.getDate()-a);const l=r.toISOString().split("T")[0],{count:n}=await d.from("orders").select("*",{count:"exact",head:!0}).gte("created_at",l).lt("created_at",new Date(r.getTime()+864e5).toISOString().split("T")[0]);t.push({name:e[r.getDay()],orders:n||0})}return t}});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Dashboard"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Jami buyurtmalar"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:_?.totalOrders||0})})]}),e.jsxs(t,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Bugungi buyurtmalar"}),e.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:_?.todayOrders||0})})]}),e.jsxs(t,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Mahsulotlar"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:_?.totalProducts||0})})]}),e.jsxs(t,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Foydalanuvchilar"}),e.jsx(i,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:_?.totalUsers||0})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(a,{children:e.jsx(r,{children:"Haftalik buyurtmalar"})}),e.jsx(l,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(u,{width:"100%",height:"100%",children:e.jsxs(h,{data:D||[],children:[e.jsx(j,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(f,{dataKey:"name",className:"text-muted-foreground"}),e.jsx(g,{className:"text-muted-foreground"}),e.jsx(y,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(p,{dataKey:"orders",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})})]}),e.jsxs(t,{children:[e.jsx(a,{children:e.jsx(r,{children:"Kategoriyalar bo'yicha sotuvlar"})}),e.jsx(l,{children:e.jsx("div",{className:"h-[300px]",children:k&&k.length>0?e.jsx(u,{width:"100%",height:"100%",children:e.jsxs(N,{children:[e.jsx(v,{data:k,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e} ${(100*s).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:k.map((s,t)=>e.jsx(b,{fill:w[t%w.length]},`cell-${t}`))}),e.jsx(y,{})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"Ma'lumot yo'q"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(a,{children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),"Eng ko'p sotilgan"]})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[q?.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-lg font-bold text-muted-foreground",children:["#",t+1]}),e.jsx("span",{className:"text-foreground",children:s.name_uz})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.sold_count||0," ta"]})]},s.id)),(!q||0===q.length)&&e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Ma'lumot yo'q"})]})})]}),e.jsxs(t,{children:[e.jsx(a,{children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-5 w-5"}),"Eng ko'p ko'rilgan"]})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[q?.sort((e,s)=>(s.view_count||0)-(e.view_count||0)).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-lg font-bold text-muted-foreground",children:["#",t+1]}),e.jsx("span",{className:"text-foreground",children:s.name_uz})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.view_count||0," ko'rish"]})]},s.id)),(!q||0===q.length)&&e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Ma'lumot yo'q"})]})})]})]})]})};export{_ as default};
