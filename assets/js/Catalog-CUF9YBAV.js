import{u as e,n as a,r as s,j as r}from"./vendor-react-Di3sF8BB.js";import{u as i}from"./vendor-query-B031p5Or.js";import{u as l,L as t,S as n,a as c,b as d,B as o,c as m,d as h,e as x,f as g,P as u,s as p}from"./index-Ba4agNH_.js";import{S as j,a as v,b as f,c as y,d as N}from"./select-DtVDAZoX.js";import{B as b}from"./BreadcrumbNav-LvkZYVfj.js";import{r as k,X as w}from"./vendor-icons-CX117ToW.js";import"./vendor-radix-6DXuBJN5.js";import"./vendor-utils-BNexaxpF.js";import"./vendor-supabase-C3HG44mJ.js";const _=()=>{const{t:_}=e(),{currentLanguage:q}=l(),[z,$]=a(),[B,C]=s.useState(!1),K=z.get("category"),P=z.get("search")||"",L=z.get("sort")||"newest",S="true"===z.get("featured"),{data:M}=i({queryKey:["categories"],queryFn:async()=>{const{data:e}=await p.from("categories").select("*");return e||[]}}),{data:R,isLoading:A}=i({queryKey:["products",K,P,L,S],queryFn:async()=>{let e=p.from("products").select("*").eq("is_active",!0);switch(K&&(e=e.eq("category_id",K)),P&&(e=e.or(`name_uz.ilike.%${P}%,name_ru.ilike.%${P}%,name_en.ilike.%${P}%`)),S&&(e=e.eq("is_featured",!0)),L){case"price_asc":e=e.order("price",{ascending:!0});break;case"price_desc":e=e.order("price",{ascending:!1});break;case"popular":e=e.order("sold_count",{ascending:!1});break;case"rating":e=e.order("rating",{ascending:!1});break;default:e=e.order("created_at",{ascending:!1})}const{data:a}=await e;return a||[]}}),F=(e,a)=>e[`name_${a}`]||e.name_uz,T=e=>{e?z.set("category",e):z.delete("category"),$(z)},O=()=>{$(new URLSearchParams)},U=[K,P,S].filter(Boolean).length,V=()=>r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold mb-3",children:_("categories")}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"flex items-center gap-2 p-2 rounded-md cursor-pointer transition-colors "+(K?"hover:bg-secondary":"bg-primary/10 text-primary"),onClick:()=>T(null),children:r.jsx("span",{children:_("allProducts")})}),M?.map(e=>r.jsx("div",{className:"flex items-center gap-2 p-2 rounded-md cursor-pointer transition-colors "+(K===e.id?"bg-primary/10 text-primary":"hover:bg-secondary"),onClick:()=>T(e.id),children:r.jsx("span",{children:F(e,q)})},e.id))]})]})}),Y=M?.find(e=>e.id===K),D=Y?`${F(Y,q)} - Katalog`:"Katalog - Barcha Mahsulotlar",E=Y?`${F(Y,q)} kategoriyasidagi mahsulotlar - Premium Market'da eng yaxshi narxlarda xarid qiling. Tez yetkazib berish, sifat kafolati.`:"Premium Market katalogi - barcha mahsulotlar eng yaxshi narxlarda. Sifatli mahsulotlar, tez yetkazib berish, 24/7 qo'llab-quvvatlash.",G="https://premium-market.uz",H=[{name:"Bosh sahifa",url:G},{name:"Katalog",url:`${G}/catalog`},...Y?[{name:F(Y,q)}]:[]];return r.jsxs(t,{children:[r.jsx(n,{title:D,description:E,keywords:["katalog","mahsulotlar","online shopping","premium market",Y?.name_uz,"chegirmalar","arzon narx"].filter(Boolean),breadcrumbs:H,url:K?`${G}/catalog?category=${K}`:`${G}/catalog`}),r.jsxs("div",{className:"container py-8",children:[r.jsx(b,{items:[{name:"Katalog",url:K?"/catalog":void 0},...Y?[{name:F(Y,q)}]:[]],className:"mb-6"}),r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-serif font-bold",children:Y?F(Y,q):_("catalog")}),R&&r.jsxs("p",{className:"text-muted-foreground mt-1",children:[R.length," ",_("allProducts").toLowerCase()]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs(c,{open:B,onOpenChange:C,children:[r.jsx(d,{asChild:!0,children:r.jsxs(o,{variant:"outline",className:"md:hidden",children:[r.jsx(k,{className:"h-4 w-4 mr-2"}),_("filter"),U>0&&r.jsx(m,{className:"ml-2",variant:"secondary",children:U})]})}),r.jsxs(h,{side:"left",children:[r.jsx(x,{children:r.jsx(g,{children:_("filter")})}),r.jsx("div",{className:"mt-6",children:r.jsx(V,{})})]})]}),r.jsxs(j,{value:L,onValueChange:e=>{z.set("sort",e),$(z)},children:[r.jsx(v,{className:"w-[180px]",children:r.jsx(f,{placeholder:_("sortBy")})}),r.jsxs(y,{children:[r.jsx(N,{value:"newest",children:"Yangi"}),r.jsx(N,{value:"popular",children:"Mashhur"}),r.jsx(N,{value:"price_asc",children:"Narx: arzon"}),r.jsx(N,{value:"price_desc",children:"Narx: qimmat"}),r.jsx(N,{value:"rating",children:"Reyting"})]})]}),U>0&&r.jsxs(o,{variant:"ghost",size:"sm",onClick:O,children:[r.jsx(w,{className:"h-4 w-4 mr-1"}),"Tozalash"]})]})]}),r.jsxs("div",{className:"flex gap-8",children:[r.jsx("aside",{className:"hidden md:block w-64 flex-shrink-0",children:r.jsx(V,{})}),r.jsx("div",{className:"flex-1",children:A?r.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[...Array(6)].map((e,a)=>r.jsx("div",{className:"aspect-square bg-secondary animate-pulse rounded-lg"},a))}):R&&R.length>0?r.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:R.map(e=>r.jsx(u,{product:e},e.id))}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx("p",{className:"text-muted-foreground",children:_("noResults")}),r.jsx(o,{variant:"outline",className:"mt-4",onClick:O,children:_("viewAll")})]})})]})]})]})};export{_ as default};
