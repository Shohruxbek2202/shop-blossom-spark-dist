import{r as e,j as s}from"./vendor-react-Di3sF8BB.js";import{b as a,u as i,c as r}from"./vendor-query-B031p5Or.js";import{B as t,I as n,C as l,n as d,i as c,s as o}from"./index-Ba4agNH_.js";import{D as u,a as h,b as m,c as x,d as j}from"./dialog-DQw_XWPC.js";import{L as _}from"./label-CnFGFWne.js";import{S as g}from"./switch-C5BvGJZg.js";import{T as v,a as p,b as f,c as b,d as y,e as N}from"./table-DVyzr3Yq.js";import{u as k}from"./useImageUpload-DAdDsa3J.js";import{z as w,L as C,a0 as z,a3 as q,a4 as S,a2 as F,D as R}from"./vendor-icons-CX117ToW.js";import"./vendor-radix-6DXuBJN5.js";import"./vendor-utils-BNexaxpF.js";import"./vendor-supabase-C3HG44mJ.js";const B={title_uz:"",title_ru:"",title_en:"",image_url:"",link:"",is_active:!0,sort_order:0},L=()=>{const[L,U]=e.useState(!1),[I,K]=e.useState(B),P=a(),Q=e.useRef(null),{uploadImage:D,uploading:E}=k("banner-images"),{data:T,isLoading:O}=i({queryKey:["admin-banners"],queryFn:async()=>{const{data:e,error:s}=await o.from("banners").select("*").order("sort_order");if(s)throw s;return e}}),Y=r({mutationFn:async e=>{if(e.id){const{error:s}=await o.from("banners").update({title_uz:e.title_uz,title_ru:e.title_ru,title_en:e.title_en,image_url:e.image_url,link:e.link,is_active:e.is_active,sort_order:e.sort_order}).eq("id",e.id);if(s)throw s}else{const{error:s}=await o.from("banners").insert({title_uz:e.title_uz,title_ru:e.title_ru,title_en:e.title_en,image_url:e.image_url,link:e.link,is_active:e.is_active,sort_order:e.sort_order});if(s)throw s}},onSuccess:()=>{P.invalidateQueries({queryKey:["admin-banners"]}),U(!1),K(B),c.success("Banner saqlandi")},onError:()=>{c.error("Xatolik yuz berdi")}}),A=r({mutationFn:async e=>{const{error:s}=await o.from("banners").delete().eq("id",e);if(s)throw s},onSuccess:()=>{P.invalidateQueries({queryKey:["admin-banners"]}),c.success("O'chirildi")}}),H=r({mutationFn:async({id:e,direction:s})=>{const a=T?.findIndex(s=>s.id===e)||0,i="up"===s?a-1:a+1;if(!T||i<0||i>=T.length)return;const r=T[a],t=T[i];await Promise.all([o.from("banners").update({sort_order:t.sort_order}).eq("id",r.id),o.from("banners").update({sort_order:r.sort_order}).eq("id",t.id)])},onSuccess:()=>{P.invalidateQueries({queryKey:["admin-banners"]})}});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Bannerlar"}),s.jsxs(u,{open:L,onOpenChange:U,children:[s.jsx(h,{asChild:!0,children:s.jsxs(t,{onClick:()=>K({...B,sort_order:(T?.length||0)+1}),children:[s.jsx(w,{className:"h-4 w-4 mr-2"}),"Qo'shish"]})}),s.jsxs(m,{children:[s.jsx(x,{children:s.jsx(j,{children:I.id?"Tahrirlash":"Yangi banner"})}),s.jsxs("div",{className:"grid gap-4 py-4",children:[s.jsxs("div",{children:[s.jsx(_,{children:"Sarlavha (UZ)"}),s.jsx(n,{value:I.title_uz,onChange:e=>K({...I,title_uz:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(_,{children:"Sarlavha (RU)"}),s.jsx(n,{value:I.title_ru,onChange:e=>K({...I,title_ru:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(_,{children:"Sarlavha (EN)"}),s.jsx(n,{value:I.title_en,onChange:e=>K({...I,title_en:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(_,{children:"Rasm *"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(n,{value:I.image_url,onChange:e=>K({...I,image_url:e.target.value}),placeholder:"URL yoki fayl yuklang"}),s.jsx("input",{ref:Q,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;const a=await D(s);a&&K({...I,image_url:a}),Q.current&&(Q.current.value="")},className:"hidden"}),s.jsx(t,{type:"button",variant:"outline",onClick:()=>Q.current?.click(),disabled:E,children:E?s.jsx(C,{className:"h-4 w-4 animate-spin"}):s.jsx(z,{className:"h-4 w-4"})})]})]}),I.image_url&&s.jsx("div",{className:"flex justify-center",children:s.jsx("img",{src:I.image_url,alt:"Preview",className:"w-full h-32 object-cover rounded"})}),s.jsxs("div",{children:[s.jsx(_,{children:"Havola (URL)"}),s.jsx(n,{value:I.link,onChange:e=>K({...I,link:e.target.value})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(g,{checked:I.is_active,onCheckedChange:e=>K({...I,is_active:e})}),s.jsx(_,{children:"Faol"})]}),s.jsx(t,{onClick:()=>Y.mutate(I),disabled:Y.isPending||!I.image_url,children:Y.isPending?"Saqlanmoqda...":"Saqlash"})]})]})]})]}),s.jsx(l,{children:s.jsx(d,{className:"p-0",children:s.jsxs(v,{children:[s.jsx(p,{children:s.jsxs(f,{children:[s.jsx(b,{children:"Tartib"}),s.jsx(b,{children:"Rasm"}),s.jsx(b,{children:"Sarlavha"}),s.jsx(b,{children:"Status"}),s.jsx(b,{className:"text-right",children:"Amallar"})]})}),s.jsxs(y,{children:[T?.map((e,a)=>s.jsxs(f,{children:[s.jsx(N,{children:s.jsxs("div",{className:"flex gap-1",children:[s.jsx(t,{variant:"ghost",size:"icon",onClick:()=>H.mutate({id:e.id,direction:"up"}),disabled:0===a,children:s.jsx(q,{className:"h-4 w-4"})}),s.jsx(t,{variant:"ghost",size:"icon",onClick:()=>H.mutate({id:e.id,direction:"down"}),disabled:a===(T?.length||0)-1,children:s.jsx(S,{className:"h-4 w-4"})})]})}),s.jsx(N,{children:s.jsx("img",{src:e.image_url,alt:"",className:"w-24 h-12 object-cover rounded"})}),s.jsx(N,{className:"font-medium",children:e.title_uz||"-"}),s.jsx(N,{children:s.jsx("span",{className:"px-2 py-1 rounded text-xs "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Faol":"Nofaol"})}),s.jsxs(N,{className:"text-right",children:[s.jsx(t,{variant:"ghost",size:"icon",onClick:()=>(e=>{K({id:e.id,title_uz:e.title_uz||"",title_ru:e.title_ru||"",title_en:e.title_en||"",image_url:e.image_url,link:e.link||"",is_active:e.is_active,sort_order:e.sort_order||0}),U(!0)})(e),children:s.jsx(F,{className:"h-4 w-4"})}),s.jsx(t,{variant:"ghost",size:"icon",onClick:()=>A.mutate(e.id),children:s.jsx(R,{className:"h-4 w-4 text-destructive"})})]})]},e.id)),O&&s.jsx(f,{children:s.jsx(N,{colSpan:5,className:"text-center py-8",children:"Yuklanmoqda..."})}),!O&&0===T?.length&&s.jsx(f,{children:s.jsx(N,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Bannerlar topilmadi"})})]})]})})})]})};export{L as default};
