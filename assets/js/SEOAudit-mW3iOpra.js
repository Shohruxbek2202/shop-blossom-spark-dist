import{r as e,j as s,L as a}from"./vendor-react-Di3sF8BB.js";import{b as t,u as r}from"./vendor-query-B031p5Or.js";import{h as l,B as i,C as d,n,I as c,c as o,s as m,i as x}from"./index-DztaS-sJ.js";import{a1 as h,a2 as u}from"./vendor-radix-AkGGdVjm.js";import{D as g,b as p,c as j,d as f,e as y,f as N}from"./dialog-DU5NScf_.js";import{a9 as v,aa as b,L as w,q as k,m as _,e as z,ab as S,ac as q,ad as O,ae as M,af as A,Q as C,ag as I,ah as E}from"./vendor-icons-UB6tg7n9.js";import"./vendor-utils-BNexaxpF.js";import"./vendor-supabase-CKi7xGwz.js";const L=e.forwardRef(({className:e,value:a,...t},r)=>s.jsx(h,{ref:r,className:l("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...t,children:s.jsx(u,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));L.displayName=h.displayName;const T=e=>{const s=[];let a=100;return e.slug?e.slug.length<3?(s.push({type:"warning",message:"URL slug juda qisqa",field:"slug"}),a-=5):s.push({type:"success",message:"URL slug to'g'ri",field:"slug"}):(s.push({type:"error",message:"URL slug mavjud emas",field:"slug"}),a-=15),e.meta_title?e.meta_title.length<30?(s.push({type:"warning",message:"Meta title juda qisqa (30+ belgi tavsiya)",field:"meta_title"}),a-=5):e.meta_title.length>60?(s.push({type:"warning",message:"Meta title juda uzun (60 belgidan kam bo'lsin)",field:"meta_title"}),a-=3):s.push({type:"success",message:"Meta title optimal",field:"meta_title"}):(s.push({type:"warning",message:"Meta title mavjud emas",field:"meta_title"}),a-=5),e.meta_description?e.meta_description.length<70?(s.push({type:"warning",message:"Meta description qisqa (120+ belgi tavsiya)",field:"meta_description"}),a-=5):e.meta_description.length>160?(s.push({type:"warning",message:"Meta description uzun (160 belgidan kam bo'lsin)",field:"meta_description"}),a-=3):s.push({type:"success",message:"Meta description optimal",field:"meta_description"}):(s.push({type:"warning",message:"Meta description mavjud emas",field:"meta_description"}),a-=5),e.images&&0!==e.images.length?e.images.length<3?(s.push({type:"warning",message:`Faqat ${e.images.length} ta rasm (3+ tavsiya)`,field:"images"}),a-=5):s.push({type:"success",message:`${e.images.length} ta rasm mavjud`,field:"images"}):(s.push({type:"error",message:"Mahsulot rasmi yo'q",field:"images"}),a-=20),e.seo_keywords&&0!==e.seo_keywords.length?e.seo_keywords.length<3?(s.push({type:"warning",message:`Faqat ${e.seo_keywords.length} ta kalit so'z (3+ tavsiya)`,field:"seo_keywords"}),a-=5):s.push({type:"success",message:`${e.seo_keywords.length} ta kalit so'z`,field:"seo_keywords"}):(s.push({type:"warning",message:"SEO kalit so'zlar mavjud emas",field:"seo_keywords"}),a-=10),e.short_desc_uz||e.full_desc_uz?e.full_desc_uz?e.full_desc_uz.length<100?(s.push({type:"warning",message:"Tavsif juda qisqa (100+ so'z tavsiya)",field:"description"}),a-=5):s.push({type:"success",message:"Tavsif yetarli",field:"description"}):(s.push({type:"warning",message:"To'liq tavsif mavjud emas",field:"description"}),a-=5):(s.push({type:"error",message:"Tavsif mavjud emas",field:"description"}),a-=15),{...e,score:Math.max(0,Math.min(100,a)),issues:s}},$=()=>{const[l,h]=e.useState(""),[u,$]=e.useState(!1),[B,R]=e.useState(null),[H,U]=e.useState(!1),[F,Y]=e.useState(null);t();const{data:K,isLoading:X,refetch:D}=r({queryKey:["seo-audit-products"],queryFn:async()=>{const{data:e,error:s}=await m.from("products").select("id, slug, name_uz, meta_title, meta_description, seo_keywords, images, short_desc_uz, full_desc_uz, is_active").order("created_at",{ascending:!1});if(s)throw s;return(e||[]).map(T)}}),G=K?.filter(e=>e.name_uz.toLowerCase().includes(l.toLowerCase())||e.slug?.toLowerCase().includes(l.toLowerCase())),J={total:K?.length||0,excellent:K?.filter(e=>e.score>=90).length||0,good:K?.filter(e=>e.score>=70&&e.score<90).length||0,needsWork:K?.filter(e=>e.score>=50&&e.score<70).length||0,poor:K?.filter(e=>e.score<50).length||0,avgScore:K?.length?Math.round(K.reduce((e,s)=>e+s.score,0)/K.length):0,needsSEO:K?.filter(e=>!e.meta_title||!e.meta_description||!e.seo_keywords?.length).length||0},P=e=>e>=90?"text-green-600 dark:text-green-400":e>=70?"text-yellow-600 dark:text-yellow-400":e>=50?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400";return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"SEO Audit"}),s.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"AI yordamida SEO optimallashtirish"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(i,{variant:"outline",onClick:()=>D(),children:[s.jsx(v,{className:"h-4 w-4 mr-2"}),"Yangilash"]}),s.jsxs(i,{onClick:async()=>{$(!0);try{const{error:e}=await m.functions.invoke("ping-google",{body:{sitemapUrl:"https://premium-market.uz/sitemap.xml"}});if(e)throw e;x.success("Google, Yandex va Bing xabardor qilindi!")}catch(e){x.error("Xatolik yuz berdi")}finally{$(!1)}},disabled:u,variant:"outline",children:[u?s.jsx(v,{className:"h-4 w-4 mr-2 animate-spin"}):s.jsx(b,{className:"h-4 w-4 mr-2"}),"Google Ping"]}),s.jsxs(i,{onClick:()=>(async(e=!1)=>{U(!0);try{const{data:s,error:a}=await m.functions.invoke("seo-generator",{body:{mode:"batch",applyChanges:e}});if(a)throw a;const t=s?.results?.filter(e=>e.applied)?.length||0,r=s?.results?.length||0;e?(x.success(`${t} ta mahsulot SEO si yangilandi!`),D()):x.info(`${r} ta mahsulot uchun taklif yaratildi`)}catch(s){s.message?.includes("Rate limit")?x.error("Juda ko'p so'rov. Biroz kutib turing."):x.error("AI xatolik yuz berdi")}finally{U(!1)}})(!0),disabled:H||0===J.needsSEO,className:"bg-gradient-to-r from-primary to-accent",children:[H?s.jsx(w,{className:"h-4 w-4 mr-2 animate-spin"}):s.jsx(k,{className:"h-4 w-4 mr-2"}),"AI Batch (",J.needsSEO,")"]})]})]}),s.jsx(d,{className:"border-primary/20 bg-gradient-to-r from-primary/5 to-accent/5",children:s.jsx(n,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-3 rounded-full bg-primary/10",children:s.jsx(k,{className:"h-6 w-6 text-primary"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"AI SEO Optimallashtirish"}),s.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Har bir mahsulot uchun AI yordamida meta title, description va kalit so'zlar yarating. \"AI Batch\" tugmasi bilan barcha SEO si yo'q mahsulotlarni avtomatik optimallashtiring."}),s.jsx("div",{className:"flex items-center gap-4 text-sm",children:s.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[s.jsx(_,{className:"h-4 w-4"}),s.jsx("span",{children:"Cron job: Har soatda avtomatik tekshiriladi"})]})})]})]})})}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[s.jsx(d,{children:s.jsx(n,{className:"pt-6",children:s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-3xl font-bold text-foreground",children:[J.avgScore,"%"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"O'rtacha ball"})]})})}),s.jsx(d,{children:s.jsx(n,{className:"pt-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-green-600",children:J.excellent}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"A'lo (90%+)"})]})})}),s.jsx(d,{children:s.jsx(n,{className:"pt-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:J.good}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Yaxshi (70-89%)"})]})})}),s.jsx(d,{children:s.jsx(n,{className:"pt-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-orange-600",children:J.needsWork}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"O'rtacha (50-69%)"})]})})}),s.jsx(d,{children:s.jsx(n,{className:"pt-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-red-600",children:J.poor}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Yomon (<50%)"})]})})}),s.jsx(d,{className:"border-primary/30",children:s.jsx(n,{className:"pt-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-primary",children:J.needsSEO}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"SEO kerak"})]})})})]}),s.jsxs("div",{className:"relative",children:[s.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(c,{placeholder:"Mahsulot qidirish...",value:l,onChange:e=>h(e.target.value),className:"pl-10"})]}),X?s.jsx("div",{className:"space-y-4",children:[...Array(5)].map((e,a)=>s.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"},a))}):s.jsx("div",{className:"space-y-4",children:G?.map(e=>{return s.jsx(d,{className:"overflow-hidden",children:s.jsx(n,{className:"p-0",children:s.jsxs("div",{className:"flex flex-col md:flex-row",children:[s.jsxs("div",{className:`p-6 flex flex-col items-center justify-center min-w-[120px] ${t=e.score,t>=90?"bg-green-500":t>=70?"bg-yellow-500":t>=50?"bg-orange-500":"bg-red-500"} bg-opacity-10`,children:[s.jsx("div",{className:`text-4xl font-bold ${P(e.score)}`,children:e.score}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"SEO Ball"}),s.jsx(L,{value:e.score,className:"w-20 h-2 mt-2"})]}),s.jsxs("div",{className:"flex-1 p-4",children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-foreground",children:e.name_uz}),e.slug?s.jsxs("a",{href:`https://premium-market.uz/product/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[s.jsx(S,{className:"h-3 w-3"}),"/product/",e.slug]}):s.jsx("span",{className:"text-sm text-destructive",children:"URL mavjud emas"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(i,{variant:"outline",size:"sm",onClick:()=>(async(e,s=!1)=>{R(e);try{const{data:a,error:t}=await m.functions.invoke("seo-generator",{body:{productId:e,mode:"single",applyChanges:s}});if(t)throw t;if(a?.results?.[0]){const e=a.results[0];s?(x.success("SEO yangilandi!"),D()):Y(e)}}catch(a){a.message?.includes("Rate limit")?x.error("Juda ko'p so'rov. Biroz kutib turing."):a.message?.includes("Payment")?x.error("Kredit tugadi. Lovable AI hisobingizni to'ldiring."):x.error("AI xatolik yuz berdi")}finally{R(null)}})(e.id),disabled:B===e.id,children:B===e.id?s.jsx(w,{className:"h-4 w-4 animate-spin"}):s.jsxs(s.Fragment,{children:[s.jsx(q,{className:"h-4 w-4 mr-1"}),"AI"]})}),s.jsx(a,{to:"/panel/products",children:s.jsx(i,{variant:"outline",size:"sm",children:"Tahrirlash"})})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:e.issues.map((e,a)=>s.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 rounded-lg "+("error"===e.type?"bg-destructive/10 text-destructive":"warning"===e.type?"bg-warning/10 text-warning":"bg-success/10 text-success"),children:["error"===e.type?s.jsx(O,{className:"h-4 w-4 flex-shrink-0"}):"warning"===e.type?s.jsx(M,{className:"h-4 w-4 flex-shrink-0"}):s.jsx(A,{className:"h-4 w-4 flex-shrink-0"}),s.jsx("span",{className:"truncate",children:e.message})]},a))}),s.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[s.jsxs(o,{variant:"outline",className:"gap-1",children:[s.jsx(C,{className:"h-3 w-3"}),e.images?.length||0," rasm"]}),s.jsxs(o,{variant:"outline",className:"gap-1",children:[s.jsx(I,{className:"h-3 w-3"}),e.seo_keywords?.length||0," kalit so'z"]}),s.jsxs(o,{variant:"outline",className:"gap-1",children:[s.jsx(E,{className:"h-3 w-3"}),e.meta_title?"Meta ✓":"Meta ✗"]})]})]})]})})},e.id);var t})}),0===G?.length&&!X&&s.jsx(d,{children:s.jsx(n,{className:"py-12 text-center",children:s.jsx("p",{className:"text-muted-foreground",children:"Mahsulot topilmadi"})})}),s.jsx(g,{open:!!F,onOpenChange:()=>Y(null),children:s.jsxs(p,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(j,{children:[s.jsxs(f,{className:"flex items-center gap-2",children:[s.jsx(k,{className:"h-5 w-5 text-primary"}),"AI SEO Taklifi"]}),s.jsxs(y,{children:[F?.productName," uchun AI tomonidan yaratilgan SEO taklifi"]})]}),F&&s.jsxs("div",{className:"space-y-6 py-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Meta Title"}),F.current.meta_title&&s.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 text-sm",children:[s.jsx("span",{className:"text-xs text-muted-foreground block mb-1",children:"Hozirgi:"}),F.current.meta_title]}),s.jsxs("div",{className:"p-3 rounded-lg bg-primary/10 border border-primary/20 text-sm",children:[s.jsx("span",{className:"text-xs text-primary block mb-1",children:"AI Taklifi:"}),F.suggested.meta_title,s.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",F.suggested.meta_title.length," belgi)"]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Meta Description"}),F.current.meta_description&&s.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 text-sm",children:[s.jsx("span",{className:"text-xs text-muted-foreground block mb-1",children:"Hozirgi:"}),F.current.meta_description]}),s.jsxs("div",{className:"p-3 rounded-lg bg-primary/10 border border-primary/20 text-sm",children:[s.jsx("span",{className:"text-xs text-primary block mb-1",children:"AI Taklifi:"}),F.suggested.meta_description,s.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",F.suggested.meta_description.length," belgi)"]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"Kalit so'zlar"}),F.current.seo_keywords&&F.current.seo_keywords.length>0&&s.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[s.jsx("span",{className:"text-xs text-muted-foreground block mb-2",children:"Hozirgi:"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:F.current.seo_keywords.map((e,a)=>s.jsx(o,{variant:"secondary",className:"text-xs",children:e},a))})]}),s.jsxs("div",{className:"p-3 rounded-lg bg-primary/10 border border-primary/20",children:[s.jsx("span",{className:"text-xs text-primary block mb-2",children:"AI Taklifi (birlashtirilgan):"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:F.suggested.seo_keywords.map((e,a)=>s.jsx(o,{variant:"default",className:"text-xs",children:e},a))})]})]})]}),s.jsxs(N,{children:[s.jsx(i,{variant:"outline",onClick:()=>Y(null),children:"Bekor qilish"}),s.jsxs(i,{onClick:async()=>{if(F)try{const{error:e}=await m.from("products").update({meta_title:F.suggested.meta_title,meta_description:F.suggested.meta_description,seo_keywords:F.suggested.seo_keywords}).eq("id",F.productId);if(e)throw e;x.success("SEO yangilandi!"),Y(null),D()}catch(e){x.error("Xatolik yuz berdi")}},children:[s.jsx(A,{className:"h-4 w-4 mr-2"}),"Qo'llash"]})]})]})})]})};export{$ as default};
