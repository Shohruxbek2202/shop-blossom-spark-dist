import{r as e,j as s}from"./vendor-react-Di3sF8BB.js";import{b as a,u as i,c as r}from"./vendor-query-B031p5Or.js";import{B as l,I as t,C as d,n,i as c,g as o,s as u}from"./index-Ba4agNH_.js";import{T as m}from"./textarea-BOM3ltll.js";import{D as h,a as x,b as j,c as g,d as _}from"./dialog-DQw_XWPC.js";import{L as v}from"./label-CnFGFWne.js";import{S as p,a as f,b as y,c as N,d as k}from"./select-DtVDAZoX.js";import{S as w}from"./switch-C5BvGJZg.js";import{T as b,a as C,b as z,c as q,d as S,e as L}from"./table-DVyzr3Yq.js";import{u as M}from"./useImageUpload-DAdDsa3J.js";import{z as R,L as U,a0 as F,a1 as T,e as P,a2 as $,D as I}from"./vendor-icons-CX117ToW.js";import"./vendor-radix-6DXuBJN5.js";import"./vendor-utils-BNexaxpF.js";import"./vendor-supabase-C3HG44mJ.js";const K={slug:"",name_uz:"",name_ru:"",name_en:"",short_desc_uz:"",short_desc_ru:"",short_desc_en:"",full_desc_uz:"",full_desc_ru:"",full_desc_en:"",price:0,sale_price:null,category_id:"",stream_link:"",images:[],is_active:!0,is_featured:!1,meta_title:"",meta_description:"",seo_keywords:[],video_url:"",youtube_url:"",api_type:"mgoods",offer_id:""},Q=()=>{const[Q,D]=e.useState(""),[E,O]=e.useState(!1),[Y,A]=e.useState(K),[B,V]=e.useState(""),[G,Z]=e.useState(""),X=a(),H=e.useRef(null),J=e.useRef(null),{uploadImage:W,uploading:ee}=M("product-images"),{uploadImage:se,uploading:ae}=M("product-videos"),{data:ie,isLoading:re}=i({queryKey:["admin-products",Q],queryFn:async()=>{let e=u.from("products").select("*, categories(name_uz)").order("created_at",{ascending:!1});Q&&(e=e.or(`name_uz.ilike.%${Q}%,name_ru.ilike.%${Q}%,name_en.ilike.%${Q}%`));const{data:s,error:a}=await e;if(a)throw a;return s}}),{data:le}=i({queryKey:["categories"],queryFn:async()=>{const{data:e}=await u.from("categories").select("*").order("name_uz");return e||[]}}),te=r({mutationFn:async e=>{let s=e.slug?.trim();!s&&e.name_uz&&(s=o(e.name_uz),e.id||(s=`${s}-${Date.now().toString(36)}`));let a=e.meta_title?.trim(),i=e.meta_description?.trim();if(!a&&e.name_uz&&(a=`${e.name_uz} - Premium Market | Sotib olish`),!i&&e.name_uz){const s=e.short_desc_uz||e.full_desc_uz||"",a=e.sale_price||e.price;i=`${e.name_uz} - ${a.toLocaleString()} so'm. ${s.slice(0,100)} Premium Market'da xarid qiling!`}const r={...e,slug:s,meta_title:a,meta_description:i},l=!e.id;if(e.id){const{error:s}=await u.from("products").update(r).eq("id",e.id);if(s)throw s}else{const{error:e}=await u.from("products").insert(r);if(e)throw e}try{await u.functions.invoke("ping-google",{body:{sitemapUrl:"https://premium-market.uz/sitemap.xml"}})}catch(t){}return{isNewProduct:l}},onSuccess:e=>{X.invalidateQueries({queryKey:["admin-products"]}),O(!1),A(K),c.success(e?.isNewProduct?"Mahsulot qo'shildi va Google xabardor qilindi":"Mahsulot saqlandi")},onError:()=>{c.error("Xatolik yuz berdi")}}),de=r({mutationFn:async e=>{const{error:s}=await u.from("products").delete().eq("id",e);if(s)throw s},onSuccess:()=>{X.invalidateQueries({queryKey:["admin-products"]}),c.success("O'chirildi")}});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[s.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Mahsulotlar"}),s.jsxs(h,{open:E,onOpenChange:O,children:[s.jsx(x,{asChild:!0,children:s.jsxs(l,{onClick:()=>A(K),children:[s.jsx(R,{className:"h-4 w-4 mr-2"}),"Qo'shish"]})}),s.jsxs(j,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(g,{children:s.jsx(_,{children:Y.id?"Tahrirlash":"Yangi mahsulot"})}),s.jsxs("div",{className:"grid gap-4 py-4",children:[s.jsxs("div",{children:[s.jsx(v,{children:"URL Slug (SEO uchun)"}),s.jsx(t,{value:Y.slug||"",onChange:e=>A({...Y,slug:e.target.value}),placeholder:"avtomatik yaratiladi"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Bo'sh qoldirilsa, nomdan avtomatik yaratiladi"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(v,{children:"Nomi (UZ)"}),s.jsx(t,{value:Y.name_uz,onChange:e=>A({...Y,name_uz:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Nomi (RU)"}),s.jsx(t,{value:Y.name_ru,onChange:e=>A({...Y,name_ru:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Nomi (EN)"}),s.jsx(t,{value:Y.name_en,onChange:e=>A({...Y,name_en:e.target.value})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(v,{children:"Qisqa tavsif (UZ)"}),s.jsx(m,{value:Y.short_desc_uz,onChange:e=>A({...Y,short_desc_uz:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Qisqa tavsif (RU)"}),s.jsx(m,{value:Y.short_desc_ru,onChange:e=>A({...Y,short_desc_ru:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Qisqa tavsif (EN)"}),s.jsx(m,{value:Y.short_desc_en,onChange:e=>A({...Y,short_desc_en:e.target.value})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(v,{children:"To'liq tavsif (UZ)"}),s.jsx(m,{value:Y.full_desc_uz,onChange:e=>A({...Y,full_desc_uz:e.target.value}),rows:4})]}),s.jsxs("div",{children:[s.jsx(v,{children:"To'liq tavsif (RU)"}),s.jsx(m,{value:Y.full_desc_ru,onChange:e=>A({...Y,full_desc_ru:e.target.value}),rows:4})]}),s.jsxs("div",{children:[s.jsx(v,{children:"To'liq tavsif (EN)"}),s.jsx(m,{value:Y.full_desc_en,onChange:e=>A({...Y,full_desc_en:e.target.value}),rows:4})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx(v,{children:"Narx"}),s.jsx(t,{type:"number",value:Y.price,onChange:e=>A({...Y,price:Number(e.target.value)})})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Chegirmali narx"}),s.jsx(t,{type:"number",value:Y.sale_price||"",onChange:e=>A({...Y,sale_price:e.target.value?Number(e.target.value):null})})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Kategoriya"}),s.jsxs(p,{value:Y.category_id,onValueChange:e=>A({...Y,category_id:e}),children:[s.jsx(f,{children:s.jsx(y,{placeholder:"Tanlang"})}),s.jsx(N,{children:le?.map(e=>s.jsx(k,{value:e.id,children:e.name_uz},e.id))})]})]}),s.jsxs("div",{children:[s.jsx(v,{children:"API turi"}),s.jsxs(p,{value:Y.api_type,onValueChange:e=>A({...Y,api_type:e}),children:[s.jsx(f,{children:s.jsx(y,{placeholder:"API tanlang"})}),s.jsxs(N,{children:[s.jsx(k,{value:"mgoods",children:"MGoods (stream_link)"}),s.jsx(k,{value:"sotuvchi",children:"Sotuvchi.com (offer_id)"}),s.jsx(k,{value:"none",children:"API yubormaslik"})]})]})]})]}),"mgoods"===Y.api_type&&s.jsxs("div",{children:[s.jsx(v,{children:"Stream Link (MGoods)"}),s.jsx(t,{value:Y.stream_link,onChange:e=>A({...Y,stream_link:e.target.value}),placeholder:"https://... yoki stream kodi"})]}),"sotuvchi"===Y.api_type&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(v,{children:"Offer ID (Sotuvchi)"}),s.jsx(t,{value:Y.offer_id,onChange:e=>A({...Y,offer_id:e.target.value}),placeholder:"Masalan: 369"})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Stream (ixtiyoriy)"}),s.jsx(t,{value:Y.stream_link,onChange:e=>A({...Y,stream_link:e.target.value}),placeholder:"ABCD12 (oqim kodi)"})]})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Rasmlar"}),s.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[s.jsx("input",{ref:H,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;const a=await W(s);a&&A({...Y,images:[...Y.images,a]}),H.current&&(H.current.value="")},className:"hidden"}),s.jsx(l,{type:"button",variant:"outline",onClick:()=>H.current?.click(),disabled:ee,children:ee?s.jsxs(s.Fragment,{children:[s.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Yuklanmoqda..."]}):s.jsxs(s.Fragment,{children:[s.jsx(F,{className:"h-4 w-4 mr-2"}),"Rasm yuklash"]})})]}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[s.jsx(t,{placeholder:"yoki URL kiriting",value:B,onChange:e=>V(e.target.value)}),s.jsx(l,{type:"button",onClick:()=>{B.trim()&&(A({...Y,images:[...Y.images,B.trim()]}),V(""))},variant:"secondary",children:"URL qo'shish"})]}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Y.images.map((e,a)=>s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:e,alt:"",className:"w-20 h-20 object-cover rounded"}),s.jsx("button",{type:"button",onClick:()=>{return e=a,void A({...Y,images:Y.images.filter((s,a)=>a!==e)});var e},className:"absolute -top-2 -right-2 bg-destructive text-destructive-foreground rounded-full w-5 h-5 text-xs",children:"×"})]},a))})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-4 w-4"}),s.jsx(v,{className:"font-medium",children:"Mahsulot videosi"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(v,{children:"YouTube URL"}),s.jsx(t,{placeholder:"https://youtube.com/watch?v=...",value:Y.youtube_url,onChange:e=>A({...Y,youtube_url:e.target.value})}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"YouTube video havolasini kiriting"})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Video fayl yuklash"}),s.jsxs("div",{className:"flex gap-2 mt-1",children:[s.jsx("input",{ref:J,type:"file",accept:"video/*",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;const a=await se(s);a&&A({...Y,video_url:a}),J.current&&(J.current.value="")},className:"hidden"}),s.jsx(l,{type:"button",variant:"outline",onClick:()=>J.current?.click(),disabled:ae,className:"w-full",children:ae?s.jsxs(s.Fragment,{children:[s.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Yuklanmoqda..."]}):s.jsxs(s.Fragment,{children:[s.jsx(F,{className:"h-4 w-4 mr-2"}),"Video yuklash"]})})]}),Y.video_url&&s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-muted-foreground truncate flex-1",children:Y.video_url}),s.jsx(l,{type:"button",variant:"ghost",size:"sm",onClick:()=>A({...Y,video_url:""}),children:"O'chirish"})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(v,{children:"Meta Title"}),s.jsx(t,{value:Y.meta_title,onChange:e=>A({...Y,meta_title:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(v,{children:"Meta Description"}),s.jsx(t,{value:Y.meta_description,onChange:e=>A({...Y,meta_description:e.target.value})})]})]}),s.jsxs("div",{children:[s.jsx(v,{children:"SEO Kalit so'zlar"}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[s.jsx(t,{placeholder:"Kalit so'z",value:G,onChange:e=>Z(e.target.value)}),s.jsx(l,{type:"button",onClick:()=>{G.trim()&&(A({...Y,seo_keywords:[...Y.seo_keywords,G.trim()]}),Z(""))},children:"Qo'shish"})]}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Y.seo_keywords.map((e,a)=>s.jsxs("span",{className:"bg-muted px-2 py-1 rounded text-sm flex items-center gap-1",children:[e,s.jsx("button",{type:"button",onClick:()=>{return e=a,void A({...Y,seo_keywords:Y.seo_keywords.filter((s,a)=>a!==e)});var e},className:"text-destructive",children:"×"})]},a))})]}),s.jsxs("div",{className:"flex gap-6",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(w,{checked:Y.is_active,onCheckedChange:e=>A({...Y,is_active:e})}),s.jsx(v,{children:"Faol"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(w,{checked:Y.is_featured,onCheckedChange:e=>A({...Y,is_featured:e})}),s.jsx(v,{children:"Tavsiya etilgan"})]})]}),s.jsx(l,{onClick:()=>te.mutate(Y),disabled:te.isPending,children:te.isPending?"Saqlanmoqda...":"Saqlash"})]})]})]})]}),s.jsxs("div",{className:"relative max-w-md",children:[s.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(t,{placeholder:"Qidirish...",value:Q,onChange:e=>D(e.target.value),className:"pl-10"})]}),s.jsx(d,{children:s.jsx(n,{className:"p-0",children:s.jsxs(b,{children:[s.jsx(C,{children:s.jsxs(z,{children:[s.jsx(q,{children:"Rasm"}),s.jsx(q,{children:"Nomi"}),s.jsx(q,{children:"Kategoriya"}),s.jsx(q,{children:"Narx"}),s.jsx(q,{children:"Status"}),s.jsx(q,{className:"text-right",children:"Amallar"})]})}),s.jsxs(S,{children:[ie?.map(e=>s.jsxs(z,{children:[s.jsx(L,{children:e.images?.[0]?s.jsx("img",{src:e.images[0],alt:"",className:"w-12 h-12 object-cover rounded"}):s.jsx("div",{className:"w-12 h-12 bg-muted rounded"})}),s.jsx(L,{className:"font-medium",children:e.name_uz}),s.jsx(L,{children:e.categories?.name_uz||"-"}),s.jsx(L,{children:e.sale_price?s.jsxs("div",{children:[s.jsx("span",{className:"line-through text-muted-foreground text-sm",children:e.price.toLocaleString()}),s.jsx("span",{className:"ml-2 text-primary font-medium",children:e.sale_price.toLocaleString()})]}):s.jsxs("span",{children:[e.price.toLocaleString()," so'm"]})}),s.jsx(L,{children:s.jsx("span",{className:"px-2 py-1 rounded text-xs "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Faol":"Nofaol"})}),s.jsxs(L,{className:"text-right",children:[s.jsx(l,{variant:"ghost",size:"icon",onClick:()=>(e=>{A({id:e.id,slug:e.slug||"",name_uz:e.name_uz,name_ru:e.name_ru,name_en:e.name_en,short_desc_uz:e.short_desc_uz||"",short_desc_ru:e.short_desc_ru||"",short_desc_en:e.short_desc_en||"",full_desc_uz:e.full_desc_uz||"",full_desc_ru:e.full_desc_ru||"",full_desc_en:e.full_desc_en||"",price:e.price,sale_price:e.sale_price,category_id:e.category_id||"",stream_link:e.stream_link||"",images:e.images||[],is_active:e.is_active,is_featured:e.is_featured,meta_title:e.meta_title||"",meta_description:e.meta_description||"",seo_keywords:e.seo_keywords||[],video_url:e.video_url||"",youtube_url:e.youtube_url||"",api_type:e.api_type||"mgoods",offer_id:e.offer_id||""}),O(!0)})(e),children:s.jsx($,{className:"h-4 w-4"})}),s.jsx(l,{variant:"ghost",size:"icon",onClick:()=>de.mutate(e.id),children:s.jsx(I,{className:"h-4 w-4 text-destructive"})})]})]},e.id)),re&&s.jsx(z,{children:s.jsx(L,{colSpan:6,className:"text-center py-8",children:"Yuklanmoqda..."})}),!re&&0===ie?.length&&s.jsx(z,{children:s.jsx(L,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"Mahsulotlar topilmadi"})})]})]})})})]})};export{Q as default};
