import{r as e}from"./vendor-react-Di3sF8BB.js";import{i as t,s as a}from"./index-DztaS-sJ.js";const r=1200,o=1200,i=.8,n=(n,s={})=>{const{compress:l=!0,compressionOptions:m}=s,[d,g]=e.useState(!1);return{uploadImage:async e=>{try{g(!0);let d=e;if(l&&(e=>e.type.startsWith("image/"))(e))try{d=await(async(e,t={})=>{const{maxWidth:a=r,maxHeight:n=o,quality:s=i,format:l="webp"}=t;return new Promise((t,r)=>{const o=new Image,i=document.createElement("canvas"),m=i.getContext("2d");if(!m)return void r(new Error("Canvas context not available"));o.onload=()=>{let{width:d,height:g}=o;if(d>a||g>n){const e=Math.min(a/d,n/g);d=Math.round(d*e),g=Math.round(g*e)}i.width=d,i.height=g,m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(o,0,0,d,g);const c="jpeg"===l?"image/jpeg":"webp"===l?"image/webp":"image/png";i.toBlob(a=>{if(!a)return void r(new Error("Failed to compress image"));const o="jpeg"===l?"jpg":l,i=e.name.replace(/\.[^/.]+$/,`.${o}`),n=new File([a],i,{type:c,lastModified:Date.now()});t(n)},c,s)},o.onerror=()=>{r(new Error("Failed to load image"))};const d=new FileReader;d.onload=e=>{o.src=e.target?.result},d.onerror=()=>{r(new Error("Failed to read file"))},d.readAsDataURL(e)})})(e,m),t.success(`Rasm siqildi: ${(e.size/1024).toFixed(0)}KB â†’ ${(d.size/1024).toFixed(0)}KB`)}catch(s){}const c=d.name.split(".").pop(),u=`${Date.now()}-${Math.random().toString(36).substring(2)}.${c}`,{error:p}=await a.storage.from(n).upload(u,d);if(p)return t.error("Rasm yuklashda xatolik: "+p.message),null;const{data:h}=a.storage.from(n).getPublicUrl(u);return h.publicUrl}catch(s){return t.error("Rasm yuklashda xatolik"),null}finally{g(!1)}},uploading:d}};export{n as u};
