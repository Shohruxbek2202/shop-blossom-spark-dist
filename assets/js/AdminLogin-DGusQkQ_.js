import{r as e,j as t,f as n}from"./vendor-react-Di3sF8BB.js";import{u as r,t as a,o as l,s as i}from"./vendor-forms-Bb9WWAsU.js";import{h as s,m as o,C as c,o as u,p as d,q as m,n as p,I as f,B as h,s as v,i as g}from"./index-Ba4agNH_.js";import{F as x,a as b,b as y,c as j,d as w,e as k}from"./form-DmOIH8Ip.js";import{Y as S,Z as E,_ as C,S as P}from"./vendor-icons-CX117ToW.js";import"./vendor-radix-6DXuBJN5.js";import"./vendor-utils-BNexaxpF.js";import"./vendor-query-B031p5Or.js";import"./vendor-supabase-C3HG44mJ.js";import"./label-CnFGFWne.js";var N=Object.defineProperty,M=Object.defineProperties,T=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,D=(e,t,n)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var A=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");var B=e.createContext({}),W=e.forwardRef((t,n)=>{var r,a,l,i,s,o=t,{value:c,onChange:u,maxLength:d,textAlign:m="left",pattern:p,placeholder:f,inputMode:h="numeric",onComplete:v,pushPasswordManagerStrategy:g="increase-width",pasteTransformer:x,containerClassName:b,noScriptCSSFallback:y=z,render:j,children:w}=o,k=((e,t)=>{var n={};for(var r in e)R.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&O)for(var r of O(e))t.indexOf(r)<0&&I.call(e,r)&&(n[r]=e[r]);return n})(o,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]);let[S,E]=e.useState("string"==typeof k.defaultValue?k.defaultValue:""),C=null!=c?c:S,P=function(t){let n=e.useRef();return e.useEffect(()=>{n.current=t}),n.current}(C),N=e.useCallback(e=>{null==u||u(e),E(e)},[u]),W=e.useMemo(()=>p?"string"==typeof p?new RegExp(p):p:null,[p]),F=e.useRef(null),q=e.useRef(null),H=e.useRef({value:C,onChange:N,isIOS:"undefined"!=typeof window&&(null==(a=null==(r=null==window?void 0:window.CSS)?void 0:r.supports)?void 0:a.call(r,"-webkit-touch-callout","none"))}),L=e.useRef({prev:[null==(l=F.current)?void 0:l.selectionStart,null==(i=F.current)?void 0:i.selectionEnd,null==(s=F.current)?void 0:s.selectionDirection]});e.useImperativeHandle(n,()=>F.current,[]),e.useEffect(()=>{let e=F.current,t=q.current;if(!e||!t)return;function n(){if(document.activeElement!==e)return U(null),void Z(null);let t,n=e.selectionStart,r=e.selectionEnd,a=e.selectionDirection,l=e.maxLength,i=e.value,s=L.current.prev,o=-1,c=-1;if(0!==i.length&&null!==n&&null!==r){let e=n===r,a=n===i.length&&i.length<l;if(e&&!a){let e=n;if(0===e)o=0,c=1,t="forward";else if(e===l)o=e-1,c=e,t="backward";else if(l>1&&i.length>1){let n=0;if(null!==s[0]&&null!==s[1]){t=e<s[1]?"backward":"forward";let r=s[0]===s[1]&&s[0]<l;"backward"===t&&!r&&(n=-1)}o=n+e,c=n+e+1}}-1!==o&&-1!==c&&o!==c&&F.current.setSelectionRange(o,c,t)}let u=-1!==o?o:n,d=-1!==c?c:r,m=null!=t?t:a;U(u),Z(d),L.current.prev=[u,d,m]}if(H.current.value!==e.value&&H.current.onChange(e.value),L.current.prev=[e.selectionStart,e.selectionEnd,e.selectionDirection],document.addEventListener("selectionchange",n,{capture:!0}),n(),document.activeElement===e&&V(!0),!document.getElementById("input-otp-style")){let e=document.createElement("style");if(e.id="input-otp-style",document.head.appendChild(e),e.sheet){let t="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";_(e.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),_(e.sheet,`[data-input-otp]:autofill { ${t} }`),_(e.sheet,`[data-input-otp]:-webkit-autofill { ${t} }`),_(e.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),_(e.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let r=()=>{t&&t.style.setProperty("--root-height",`${e.clientHeight}px`)};r();let a=new ResizeObserver(r);return a.observe(e),()=>{document.removeEventListener("selectionchange",n,{capture:!0}),a.disconnect()}},[]);let[X,$]=e.useState(!1),[G,V]=e.useState(!1),[Y,U]=e.useState(null),[Q,Z]=e.useState(null);e.useEffect(()=>{!function(e){setTimeout(e,0),setTimeout(e,10),setTimeout(e,50)}(()=>{var e,t,n,r;null==(e=F.current)||e.dispatchEvent(new Event("input"));let a=null==(t=F.current)?void 0:t.selectionStart,l=null==(n=F.current)?void 0:n.selectionEnd,i=null==(r=F.current)?void 0:r.selectionDirection;null!==a&&null!==l&&(U(a),Z(l),L.current.prev=[a,l,i])})},[C,G]),e.useEffect(()=>{void 0!==P&&C!==P&&P.length<d&&C.length===d&&(null==v||v(C))},[d,v,P,C]);let J=function({containerRef:t,inputRef:n,pushPasswordManagerStrategy:r,isFocused:a}){let[l,i]=e.useState(!1),[s,o]=e.useState(!1),[c,u]=e.useState(!1),d=e.useMemo(()=>"none"!==r&&("increase-width"===r||"experimental-no-flickering"===r)&&l&&s,[l,s,r]),m=e.useCallback(()=>{let e=t.current,a=n.current;if(!e||!a||c||"none"===r)return;let l=e,s=l.getBoundingClientRect().left+l.offsetWidth-18,o=l.getBoundingClientRect().top+l.offsetHeight/2;0===document.querySelectorAll(A).length&&document.elementFromPoint(s,o)===e||(i(!0),u(!0))},[t,n,c,r]);return e.useEffect(()=>{let e=t.current;if(!e||"none"===r)return;function n(){let t=window.innerWidth-e.getBoundingClientRect().right;o(t>=40)}n();let a=setInterval(n,1e3);return()=>{clearInterval(a)}},[t,r]),e.useEffect(()=>{let e=a||document.activeElement===n.current;if("none"===r||!e)return;let t=setTimeout(m,0),l=setTimeout(m,2e3),i=setTimeout(m,5e3),s=setTimeout(()=>{u(!0)},6e3);return()=>{clearTimeout(t),clearTimeout(l),clearTimeout(i),clearTimeout(s)}},[n,a,r,m]),{hasPWMBadge:l,willPushPWMBadge:d,PWM_BADGE_SPACE_WIDTH:"40px"}}({containerRef:q,inputRef:F,pushPasswordManagerStrategy:g,isFocused:G}),K=e.useCallback(e=>{let t=e.currentTarget.value.slice(0,d);t.length>0&&W&&!W.test(t)?e.preventDefault():("string"==typeof P&&t.length<P.length&&document.dispatchEvent(new Event("selectionchange")),N(t))},[d,N,P,W]),ee=e.useCallback(()=>{var e;if(F.current){let t=Math.min(F.current.value.length,d-1),n=F.current.value.length;null==(e=F.current)||e.setSelectionRange(t,n),U(t),Z(n)}V(!0)},[d]),te=e.useCallback(e=>{var t,n;let r=F.current;if(!(x||H.current.isIOS&&e.clipboardData&&r))return;let a=e.clipboardData.getData("text/plain"),l=x?x(a):a;e.preventDefault();let i=null==(t=F.current)?void 0:t.selectionStart,s=null==(n=F.current)?void 0:n.selectionEnd,o=(i!==s?C.slice(0,i)+l+C.slice(s):C.slice(0,i)+l+C.slice(i)).slice(0,d);if(o.length>0&&W&&!W.test(o))return;r.value=o,N(o);let c=Math.min(o.length,d-1),u=o.length;r.setSelectionRange(c,u),U(c),Z(u)},[d,N,W,C]),ne=e.useMemo(()=>({position:"relative",cursor:k.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[k.disabled]),re=e.useMemo(()=>({position:"absolute",inset:0,width:J.willPushPWMBadge?`calc(100% + ${J.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:J.willPushPWMBadge?`inset(0 ${J.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:m,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[J.PWM_BADGE_SPACE_WIDTH,J.willPushPWMBadge,m]),ae=e.useMemo(()=>e.createElement("input",((e,t)=>M(e,T(t)))(((e,t)=>{for(var n in t||(t={}))R.call(t,n)&&D(e,n,t[n]);if(O)for(var n of O(t))I.call(t,n)&&D(e,n,t[n]);return e})({autoComplete:k.autoComplete||"one-time-code"},k),{"data-input-otp":!0,"data-input-otp-placeholder-shown":0===C.length||void 0,"data-input-otp-mss":Y,"data-input-otp-mse":Q,inputMode:h,pattern:null==W?void 0:W.source,"aria-placeholder":f,style:re,maxLength:d,value:C,ref:F,onPaste:e=>{var t;te(e),null==(t=k.onPaste)||t.call(k,e)},onChange:K,onMouseOver:e=>{var t;$(!0),null==(t=k.onMouseOver)||t.call(k,e)},onMouseLeave:e=>{var t;$(!1),null==(t=k.onMouseLeave)||t.call(k,e)},onFocus:e=>{var t;ee(),null==(t=k.onFocus)||t.call(k,e)},onBlur:e=>{var t;V(!1),null==(t=k.onBlur)||t.call(k,e)}})),[K,ee,te,h,re,d,Q,Y,k,null==W?void 0:W.source,C]),le=e.useMemo(()=>({slots:Array.from({length:d}).map((e,t)=>{var n;let r=G&&null!==Y&&null!==Q&&(Y===Q&&t===Y||t>=Y&&t<Q),a=void 0!==C[t]?C[t]:null;return{char:a,placeholderChar:void 0!==C[0]?null:null!=(n=null==f?void 0:f[t])?n:null,isActive:r,hasFakeCaret:r&&null===a}}),isFocused:G,isHovering:!k.disabled&&X}),[G,X,d,Q,Y,k.disabled,C]),ie=e.useMemo(()=>j?j(le):e.createElement(B.Provider,{value:le},w),[w,le,j]);return e.createElement(e.Fragment,null,null!==y&&e.createElement("noscript",null,e.createElement("style",null,y)),e.createElement("div",{ref:q,"data-input-otp-container":!0,style:ne,className:b},ie,e.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},ae)))});function _(e,t){try{e.insertRule(t)}catch(n){}}W.displayName="Input";var z="\n[data-input-otp] {\n  --nojs-bg: white !important;\n  --nojs-fg: black !important;\n\n  background-color: var(--nojs-bg) !important;\n  color: var(--nojs-fg) !important;\n  caret-color: var(--nojs-fg) !important;\n  letter-spacing: .25em !important;\n  text-align: center !important;\n  border: 1px solid var(--nojs-fg) !important;\n  border-radius: 4px !important;\n  width: 100% !important;\n}\n@media (prefers-color-scheme: dark) {\n  [data-input-otp] {\n    --nojs-bg: black !important;\n    --nojs-fg: white !important;\n  }\n}";const F=e.forwardRef(({className:e,containerClassName:n,...r},a)=>t.jsx(W,{ref:a,containerClassName:s("flex items-center gap-2 has-[:disabled]:opacity-50",n),className:s("disabled:cursor-not-allowed",e),...r}));F.displayName="InputOTP";const q=e.forwardRef(({className:e,...n},r)=>t.jsx("div",{ref:r,className:s("flex items-center",e),...n}));q.displayName="InputOTPGroup";const H=e.forwardRef(({index:n,className:r,...a},l)=>{const i=e.useContext(B),{char:o,hasFakeCaret:c,isActive:u}=i.slots[n];return t.jsxs("div",{ref:l,className:s("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",u&&"z-10 ring-2 ring-ring ring-offset-background",r),...a,children:[o,c&&t.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});H.displayName="InputOTPSlot";e.forwardRef(({...e},n)=>t.jsx("div",{ref:n,role:"separator",...e,children:t.jsx(S,{})})).displayName="InputOTPSeparator";const L=l({email:i().email("Email noto'g'ri"),password:i().min(6,"Parol kamida 6 ta belgidan iborat bo'lishi kerak")}),X=()=>{const l=n(),{setAdminVerified:i}=o(),[s,S]=e.useState(!1),[N,M]=e.useState("credentials"),[T,O]=e.useState(null),[R,I]=e.useState(""),[D,A]=e.useState(!1),B=r({resolver:a(L),defaultValues:{email:"",password:""}});return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30 p-4",children:t.jsxs(c,{className:"w-full max-w-md",children:[t.jsxs(u,{className:"text-center",children:[t.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:"credentials"===N?t.jsx(E,{className:"h-6 w-6 text-primary"}):t.jsx(C,{className:"h-6 w-6 text-primary"})}),t.jsx(d,{className:"text-2xl font-bold",children:"Admin Panel"}),t.jsx(m,{children:"credentials"===N?"Boshqaruv paneliga kirish uchun tizimga kiring":"Telegram orqali yuborilgan kodni kiriting"})]}),t.jsx(p,{children:"credentials"===N?t.jsx(x,{...B,children:t.jsxs("form",{onSubmit:B.handleSubmit(async e=>{S(!0);try{const{data:t,error:n}=await v.auth.signInWithPassword({email:e.email,password:e.password});if(n)return void(n.message.includes("Invalid login")?g.error("Email yoki parol noto'g'ri"):g.error(n.message));if(!t.user)return void g.error("Foydalanuvchi topilmadi");const r=await v.functions.invoke("admin-verify",{body:{action:"send_code",userId:t.user.id,userEmail:t.user.email}});if(r.error||!r.data?.success){const e=r.data?.error||r.error?.message||"Xatolik yuz berdi";return g.error(e),void(await v.auth.signOut())}O(t.user.id),M("verification"),g.success("Telegram orqali kod yuborildi")}catch(t){g.error("Xatolik yuz berdi")}finally{S(!1)}}),className:"space-y-4",children:[t.jsx(b,{control:B.control,name:"email",render:({field:e})=>t.jsxs(y,{children:[t.jsx(j,{children:"Email"}),t.jsx(w,{children:t.jsx(f,{placeholder:"admin@example.com",type:"email",...e})}),t.jsx(k,{})]})}),t.jsx(b,{control:B.control,name:"password",render:({field:e})=>t.jsxs(y,{children:[t.jsx(j,{children:"Parol"}),t.jsx(w,{children:t.jsx(f,{type:"password",placeholder:"******",...e})}),t.jsx(k,{})]})}),t.jsx(h,{type:"submit",className:"w-full",disabled:s,children:s?"Tekshirilmoqda...":"Davom etish"})]})}):t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx(F,{maxLength:6,value:R,onChange:I,children:t.jsxs(q,{children:[t.jsx(H,{index:0}),t.jsx(H,{index:1}),t.jsx(H,{index:2}),t.jsx(H,{index:3}),t.jsx(H,{index:4}),t.jsx(H,{index:5})]})})}),t.jsx(h,{onClick:async()=>{if(6===R.length){S(!0);try{const e=await v.functions.invoke("admin-verify",{body:{action:"verify_code",userId:T,code:R}});if(e.error||!e.data?.success){const t=e.data?.error||e.error?.message||"Xatolik yuz berdi";return void g.error(t)}i(!0),g.success("Muvaffaqiyatli kirdingiz!"),l("/panel")}catch(e){g.error("Xatolik yuz berdi")}finally{S(!1)}}else g.error("6 raqamli kodni kiriting")},className:"w-full",disabled:s||6!==R.length,children:s?"Tekshirilmoqda...":"Tasdiqlash"}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx(h,{variant:"ghost",size:"sm",onClick:async()=>{await v.auth.signOut(),M("credentials"),O(null),I("")},disabled:s,children:"Orqaga"}),t.jsxs(h,{variant:"ghost",size:"sm",onClick:async()=>{if(T){A(!0);try{const{data:{user:e}}=await v.auth.getUser(),t=await v.functions.invoke("admin-verify",{body:{action:"send_code",userId:T,userEmail:e?.email||""}});if(t.error||!t.data?.success)return void g.error(t.data?.error||"Xatolik yuz berdi");I(""),g.success("Yangi kod yuborildi")}catch(e){g.error("Xatolik yuz berdi")}finally{A(!1)}}},disabled:D||s,children:[t.jsx(P,{className:"h-4 w-4 mr-1"}),D?"Yuborilmoqda...":"Qayta yuborish"]})]})]})})]})})};export{X as default};
